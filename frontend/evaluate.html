<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
<h2>ประเมินเพื่อน</h2>

<select id="evaluated_id"></select>

<label>ความรับผิดชอบ</label>
<input type="number" id="responsibility" min="1" max="5">

<label>ทำงานเป็นทีม</label>
<input type="number" id="teamwork" min="1" max="5">

<label>ตรงต่อเวลา</label>
<input type="number" id="punctuality" min="1" max="5">

<textarea id="comment" placeholder="ความคิดเห็น"></textarea>

<button onclick="submitEval()">บันทึก</button>
<button onclick="showSummary()">ดูสรุปผล</button>

<div id="result"></div>
</div>

<script>
const user=JSON.parse(localStorage.getItem("user"));
const group_id=1;

fetch("/members/"+group_id)
.then(res=>res.json())
.then(data=>{
const select=document.getElementById("evaluated_id");
data.forEach(m=>{
if(m.id!==user.id){
select.innerHTML+=`<option value="${m.id}">${m.name}</option>`;
}
});
});

async function submitEval(){
await fetch("/evaluate",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
group_id,
evaluator_id:user.id,
evaluated_id:document.getElementById("evaluated_id").value,
responsibility:document.getElementById("responsibility").value,
teamwork:document.getElementById("teamwork").value,
punctuality:document.getElementById("punctuality").value,
comment:document.getElementById("comment").value
})
});
alert("บันทึกแล้ว");
}

async function showSummary(){
const res=await fetch("/summary/"+group_id);
const data=await res.json();

let html="<h3>สรุปผล</h3>";
data.forEach(d=>{
html+=`${d.name} : ${d.avg_score}<br>`;
});
document.getElementById("result").innerHTML=html;
}
</script>

</body>
</html>
